<!DOCTYPE html>
<html class="ui-index">
	<head>
		<meta charset="UTF-8" />
		<title></title>
		<base href="./" />
        <link rel="stylesheet" type="text/css" href="assets/css/global.css" />
        <link rel="stylesheet" type="text/css" href="assets/css/index.css" />
        <link rel="stylesheet" type="text/css" href="assets/css/controls.css" />
		<style type="text/css">
			html {
				transition: all 0.1s ease-in-out 0s;
				overflow: hidden;
			}
		</style>
        <link rel="stylesheet" type="text/css" href="assets/css/theme.scss" />
		<script type="text/javascript">
			var gui = require('nw.gui'), win = gui.Window.get(), miniPlayerActive = false;
			document.title = gui.App.manifest.window.title;
			function traceback() { 
				try { 
					var a = {}; 
					a.debug(); 
				} catch(ex) {
					return ex.stack.replace('TypeError: a.debug is not a function', '').trim()
				}
			}
			function logErr(){
				if(!fs){
					fs = require('fs')
				}
				if(!fs.existsSync('error.log')){
					fs.closeSync(fs.openSync('error.log', 'w')); // touch
				}
				return fs.appendFileSync('error.log', JSON.stringify(Array.from(arguments))+"\r\n"+traceback()+"\r\n\r\n");
			}
			process.removeAllListeners('uncaughtException');
			process.removeAllListeners('unhandledRejection');
			process.on('uncaughtException', (err) => {
				console.error('Unhandled exception', err);
				if(typeof(logErr)=='function'){
					logErr('Unhandled exception', err)
				}
				//process.exit(1)
				return true;
			});
			process.on('unhandledRejection', (reason, p) => {
				console.error(reason, 'Unhandled Rejection at Promise', p);
				if(typeof(logErr)=='function'){
					logErr(reason, 'Unhandled Rejection at Promise', p)
				}
				//process.exit(1)
				return true;
			})
		</script>
	</head>
	<body tabindex="-1"> 
		<div id="splash" class="fit-screen show">
			<img class="splash-image" width="320" height="180" src="assets/images/splash.png" />
			<img class="splash-spinner" src="assets/images/loading.gif" width="30" height="30" />
		</div>
		<div id="modal-overlay">
			<div>
				<div>
					
				</div>
			</div>
		</div>
		<script type="text/javascript" src="assets/js/jquery.js"></script>
		<script type="text/javascript" src="assets/js/jquery.shortcuts.min.js"></script>
        <script type="text/javascript" src="assets/js/blocked_domains.js"></script>
		<script type="text/javascript" src="assets/js/global.js"></script>
		<script type="text/javascript">
			loadTheming()
		</script>
        <script type="text/javascript" src="assets/js/index.js"></script>
        <script type="text/javascript" src="assets/js/countries.js"></script>
		<script type="text/javascript" src="assets/js/fitter.js"></script>
		<script type="text/javascript" src="assets/js/playback.js"></script>
        <script type="text/javascript" src="assets/js/iptv.js"></script>
        <script type="text/javascript" src="assets/js/controls.js"></script>
        <script type="text/javascript" src="assets/js/menu.js"></script>
        <script type="text/javascript" src="assets/js/menu-feeding.js"></script>
        <script type="text/javascript" src="assets/js/jquery.idle.min.js"></script>
        <script type="text/javascript" src="assets/js/jquery.viewport.js"></script>
		<iframe id="testing-player" class="hide" height="100%" frameborder="0" scrolling="no" src="/testing-player.html"></iframe>
		<iframe id="sandbox" class="fit-player hide" nwdisable nwfaketop height="100%" frameborder="0" src="/blank.html"></iframe>
		<iframe id="overlay" class="fit-player show" height="100%" allowtransparency="true" frameborder="0" scrolling="no" src="/overlay.html"></iframe>
		<iframe id="player" class="fit-player hide" height="100%" frameborder="0" scrolling="no" src="/player.html" allowfullscreen></iframe>
		<div id="player-top-bar" class="fit-player-min">
			<a href="#" data-title-lng-key="RELOAD"><i style="font-size: 93%;" class="fas fa-sync-alt"></i> <span></span></a> &middot; 
			<span class="try-other"><a href="#" data-title-lng-key="TRY_OTHER_STREAM"><i style="font-size: 93%;" class="fas fa-random"></i> <span></span></a> &middot; </span>
			<a href="#" data-title-lng-key="STOP"><i style="font-size: 93%;" class="fas fa-square"></i> <span></span></a>
		</div>
		<div id="player-status" class="fit-player">
			<div class="fac fac-loading">
				<i class="fas fa-circle-notch fa-spin"></i>
			</div>
			<div class="fac fac-paused">
				<i class="fas fa-play"></i>
			</div>
		</div>
		<div id="suggest">
			<div>
				<div id="suggest-a">
					&nbsp;
				</div>
				<div id="suggest-b">
					&nbsp;
				</div>
			</div>
		</div>
		<div class="hide">
			<input id="saveas" type="file" nwsaveas />
		</div>
		<div id="menu-trigger-icon">
			<i class="fas fa-chevron-left"></i>
		</div>
		<span id="home-icons">
			<a href="#" data-title-lng-key="BOOKMARKS" onmousedown="goBookmarks()" id="home-icon-bookmark" class="option" tabindex="995" style="top: -1px;">
				<i class="fas fa-star" aria-hidden="true"></i>
			</a>
			<a href="#" data-title-lng-key="SEARCH" onmousedown="goSearch()" id="home-icon-search" class="option" tabindex="996" style="top: -1px;">
				<i class="fas fa-search" aria-hidden="true"></i>
			</a>
			<a href="#" data-title-lng-key="OPEN_FILE" onmousedown="goOpen();return false" id="home-icon-open" class="option" tabindex="997" style="top: 1px;">
				<i class="fas fa-folder-open" aria-hidden="true"></i>
			</a>
			<a href="#" title="Megacubo" onmousedown="about()" id="home-icon-help" class="option" tabindex="998" style="font-size: 109%; top: 1px;">
				<i class="fas fa-info-circle" aria-hidden="true"></i>
			</a>
		</span>
		<span id="list-icons">
			<a href="#" onmousedown="menuScrollUp()" data-title-lng-key="BACK" id="home-icon-back" class="option" tabindex="999" style="top: 0;">
				<i class="fas fa-chevron-up" aria-hidden="true"></i>
			</a>
		</span>
		<div id="controls" class="fit-screen" tabindex="-1">
			<div id="controls-in" tabindex="-1">
				<div>
					<div class="list">
						<div>
							<div>
								LOW MEMORY?
							</div>
						</div>
					</div>
				</div>
			</div>
			<a href="javascript:;" id="controls-toggle" onmousedown="toggleControls()">
				<i class="fas fa-chevron-right"></i>
			</a>
		</div>
		<div id="side-widget-container">
			<div id="side-widget"></div>
		</div>
        <div id="notify-area" class="fit-player"></div>
		<script type="text/javascript">
			var requestIdReferersTable = [], minVideoContentLength = (50 * (1024 * 1024)), fitterEnabled = true;
			function menuScrollUp(){
				jQuery('.list').stop().animate({scrollTop: 0}, 75, 'swing')
			}
			jQuery(document).on('lngload', function (){
				jQuery('body').on('click', (e) => { 
					if(e.target.tagName.toLowerCase()=='body'){ // fallback for when #sandbox or #player has pointer-events: none
						PlaybackManager.play()
					}
				});
				jQuery('#controls').removeClass('hide').addClass('show'); 
				var actions = {
					'RELOAD': goReload,
					'TRY_OTHER_STREAM': switchPlayingStream,
					'STOP': () => {
						stop()
					}
				};
				jQuery("#player-top-bar a").each((i, element) => {
					var je = jQuery(element), key = je.attr('data-title-lng-key');
					if(key && Lang[key]){
						je.attr('aria-label', Lang[key]).prop('title', Lang[key]).on('mousedown', actions[key]);
						je.find('span').html(Lang[key])
					}
				}).on('click', (event) => {
					event.preventDefault();
					event.stopPropagation()
				});
				bindWebRequest();
				if(!Config.get('locale')){
					var locale = getLocale(true);
					if(locale == 'en'){
						jQuery.getJSON('http://app.megacubo.net/get-lang', (data) => {
							if(data.length == 2 && data != 'en') {
								// unsure of language, ask user
								goChangeLang()
							} else {
								Config.set('locale', 'en')
							}
						})
					}
				}
				var nwcf = require('nw-custom-frame');
				nwcf.attach(window, {
					"size": 30, // You can specify the size in em,rem, etc...
					"frameIconSize": 21, // You can specify the size in em,rem, etc...
					"includeCSS": false, 
					"locales": {
						'en': {
							"close": Lang.CLOSE,
							"maximize": Lang.MAXIMIZE,
							"restore": Lang.RESTORE,
							"minimize": Lang.MINIMIZE
						},
						locale: {
							"close": Lang.CLOSE,
							"maximize": Lang.MAXIMIZE,
							"restore": Lang.RESTORE,
							"minimize": Lang.MINIMIZE
						}
					},
				});
				jQuery(document).on('show', () => { // tricky hack to solve a font drawing bug
					//console.error('one');
					var t = jQuery('.nw-cf-buttons'), is = t.find('i');
					is.each((i, el) => {
						el = jQuery(el);
						el.prop('className', el.prop('className').
							replaceAll('nw-cf-icon-close', 'nw-cf-icon fas fa-times').
							replaceAll('nw-cf-icon-restore', 'nw-cf-icon fas fa-window-restore').
							replaceAll('nw-cf-icon-maximize', 'nw-cf-icon far fa-window-maximize').
							replaceAll('nw-cf-icon-minimize', 'nw-cf-icon fas fa-window-minimize')
						)
					});
					var close = jQuery('.nw-cf-close');
					close.replaceWith(close.outerHTML()); // override closing behaviour
					jQuery('#menu-trigger-icon').prop('title', Lang.SHOW_HIDE_MENU).attr('aria-label', Lang.SHOW_HIDE_MENU);
					jQuery.getScript("assets/fa/js/all.js");
					jQuery('.nw-cf-close').on('click', closeWindow);
					//console.error('two');
				});
				var statsAlive = () => {
					var s = sendStatsPrepareEntry(currentStream());
					sendStats('alive', s)
				}
				setInterval(statsAlive, 600000); // each 600 secs
				setTimeout(statsAlive, 5000);

				win.on('minimize', minimizeCallback);
				jQuery('.nw-cf-btn.nw-cf-minimize').on('click', minimizeCallback);
				handleOpenArguments(gui.App.argv)
			})
		</script>
	</body>
</html>
